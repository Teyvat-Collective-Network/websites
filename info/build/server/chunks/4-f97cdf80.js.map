{"version":3,"file":"4-f97cdf80.js","sources":["../../../.svelte-kit/adapter-node/entries/pages/apply/_page.server.ts.js","../../../.svelte-kit/adapter-node/nodes/4.js"],"sourcesContent":["import { b as bot, O as OBSERVER_CHANNEL, A as APPLICANTS_CHANNEL, a as OFFICIAL_BUSINESS, N as NEW_APPLICANT_TAG, c as NEW_APPLICANT_ALERT_ROLE } from \"../../../chunks/bot.js\";\nimport { f as fail } from \"../../../chunks/index.js\";\nimport { ChannelType } from \"discord.js\";\nconst actions = {\n  default: async ({ request, locals, fetch }) => {\n    const data = await request.formData();\n    const user = locals.user;\n    if (!user)\n      return fail(500, { error: \"Not Authenticated\" });\n    const mascot = data.get(\"mascot\")?.trim();\n    const role = data.get(\"role\");\n    const roleother = data.get(\"roleother\")?.trim();\n    const ownerid = role === \"owner\" ? \"\" : data.get(\"ownerid\")?.trim();\n    const invite = data.get(\"invite\")?.trim();\n    const nsfw = data.get(\"nsfw\");\n    const experience = data.get(\"experience\")?.trim();\n    const shortgoals = data.get(\"shortgoals\")?.trim();\n    const longgoals = data.get(\"longgoals\")?.trim();\n    const additional = data.get(\"additional\")?.trim();\n    const observerchannelconsent = data.has(\"observerchannelconsent\");\n    const observerauditconsent = data.has(\"observerauditconsent\");\n    const partnerlistconsent = data.has(\"partnerlistconsent\");\n    const eventsconsent = data.has(\"eventsconsent\");\n    const values = {\n      mascot,\n      role,\n      roleother,\n      ownerid,\n      invite,\n      nsfw,\n      experience,\n      shortgoals,\n      longgoals,\n      additional,\n      observerchannelconsent,\n      observerauditconsent,\n      partnerlistconsent,\n      eventsconsent\n    };\n    const abort = (code, message) => fail(code, {\n      error: message,\n      ...values\n    });\n    if (!mascot)\n      return abort(400, \"Missing mascot character.\");\n    if (![\"owner\", \"admin\", \"mod\", \"other\"].includes(role))\n      return abort(400, \"Invalid role selection.\");\n    if (role === \"other\" && !roleother)\n      return abort(400, 'Role must be specified if you selected \"other\".');\n    if (role !== \"owner\" && !ownerid)\n      return abort(400, \"Owner must be specified if you are not the owner.\");\n    if (role !== \"owner\" && user.id === ownerid)\n      return abort(400, 'If you are the owner, please set your role to \"owner\".');\n    if (!invite?.match(\n      /^(https:\\/\\/)?discord(?:(?:app)?\\.com\\/invite|\\.gg(?:\\/invite)?)\\/[\\w-]{2,255}$/i\n    ))\n      return abort(400, \"Missing invite.\");\n    if (![\"private\", \"public\", \"no\"].includes(nsfw))\n      return abort(400, \"Invalid NSFW selection.\");\n    if (!shortgoals)\n      return abort(400, \"Missing short-term goals.\");\n    if (!longgoals)\n      return abort(400, \"Missing long-term goals.\");\n    if (!observerchannelconsent || !observerauditconsent || !partnerlistconsent || !eventsconsent)\n      return abort(400, \"Missing consent.\");\n    if ((experience?.length ?? 0) > 1024 || (shortgoals?.length ?? 0) > 1024 || (longgoals?.length ?? 0) > 1024 || (additional?.length ?? 0) > 1024)\n      return abort(400, \"Length limit exceeded.\");\n    let invite_data;\n    try {\n      invite_data = await bot.fetchInvite(invite);\n      if (!invite_data)\n        throw 0;\n    } catch {\n      return abort(400, \"Invalid invite.\");\n    }\n    let owner;\n    if (ownerid) {\n      try {\n        owner = await bot.users.fetch(ownerid);\n      } catch {\n        return abort(400, `Owner ID (<code>${ownerid}</code>) was invalid.`);\n      }\n    }\n    const observer_channel = bot.channels.cache.get(OBSERVER_CHANNEL);\n    const applicants_channel = bot.channels.cache.get(APPLICANTS_CHANNEL);\n    const official_business = bot.channels.cache.get(OFFICIAL_BUSINESS);\n    if (!observer_channel?.isTextBased() || applicants_channel?.type !== ChannelType.GuildForum || !official_business?.isTextBased())\n      return abort(500, \"Incomplete setup; please contact an observer.\");\n    try {\n      const display_name = invite_data.guild.name.toLowerCase().includes(mascot.toLowerCase()) ? invite_data.guild.name : `${invite_data.guild.name} (${mascot} Mains)`;\n      const submitter = role === \"owner\" ? `<@${user.id}>` : `<@${user.id}> (on behalf of ${owner})`;\n      const thread = await applicants_channel.threads.create({\n        name: `${mascot} Mains`,\n        message: {\n          embeds: [\n            {\n              title: \"**New Application**\",\n              description: `**${submitter}** applied for **${display_name}**. Their role in the server is: ${role !== \"other\" ? role : roleother}. The server has ${invite_data.memberCount} members and was created at <t:${Math.floor(\n                invite_data.guild.createdTimestamp / 1e3\n              )}:f>.`,\n              color: 2961718,\n              fields: [\n                { name: \"Invite\", value: invite },\n                {\n                  name: \"NSFW\",\n                  value: {\n                    no: \"None\",\n                    private: \"Yes, hidden from regular users.\",\n                    public: \"Yes, visible to regular users.\"\n                  }[nsfw]\n                }\n              ]\n            }\n          ]\n        },\n        appliedTags: [NEW_APPLICANT_TAG]\n      });\n      await observer_channel.send({\n        embeds: [\n          {\n            title: \"**New Application**\",\n            description: `**${submitter}** applied for **${display_name}**. Check it out in ${applicants_channel} here: <${thread.url}>. Here's the additional information.`,\n            color: 2961718,\n            fields: [\n              experience && { name: \"Prior Experience\", value: experience },\n              { name: \"Short-Term Server Goals\", value: shortgoals },\n              { name: \"Long-Term Server Goals\", value: longgoals },\n              additional && {\n                name: \"Additional Questions/Comments\",\n                value: additional\n              }\n            ].filter((x) => !!x)\n          }\n        ]\n      });\n      await official_business.send(\n        `<@&${NEW_APPLICANT_ALERT_ROLE}> **${submitter}** applied for **${display_name}**. Please check out the application in ${applicants_channel} here: <${thread.url}>.`\n      );\n    } catch {\n      return abort(500, \"Posting your application failed; please contact an observer.\");\n    }\n    return { success: true };\n  }\n};\nexport {\n  actions\n};\n","import * as server from '../entries/pages/apply/_page.server.ts.js';\n\nexport const index = 4;\nexport const component = async () => (await import('../entries/pages/apply/_page.svelte.js')).default;\nexport const file = '_app/immutable/components/pages/apply/_page.svelte-0d7a4112.js';\nexport { server };\nexport const imports = [\"_app/immutable/components/pages/apply/_page.svelte-0d7a4112.js\",\"_app/immutable/chunks/index-c4baf36c.js\",\"_app/immutable/chunks/public-962e99ca.js\",\"_app/immutable/chunks/index-1e14ffe7.js\",\"_app/immutable/chunks/Callout-2d6b8933.js\",\"_app/immutable/chunks/Invite-6ce98080.js\",\"_app/immutable/chunks/LoggedInAs-8fa87d23.js\"];\nexport const stylesheets = [\"_app/immutable/assets/_page-9fe5974d.css\",\"_app/immutable/assets/index-6a431cf5.css\",\"_app/immutable/assets/Callout-cc38d962.css\",\"_app/immutable/assets/Invite-3e52a023.css\"];\nexport const fonts = [];\n"],"names":[],"mappings":"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"}